{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}

{{ define "main" }}
{{ $toc := .TableOfContents }}
{{ $hasToc := gt (len ($toc | plainify)) 0 }}
{{ $tocId := "mobile-toc-inline" }}
{{ $tocModalId := "mobile-toc-modal" }}
<div class="article-layout">
  <article class="article">
    {{ $authorName := .Params.author | default (.Site.Params.author.name | default "") }}
    {{ $authorHandle := cond (and (not (isset .Params "author")) (.Site.Params.author.twitter)) (printf "@%s" .Site.Params.author.twitter) ($authorName | default (.Site.Params.author.name | default "unknown")) }}
    {{ $authorLink := "/page/about/" | relLangURL }}
    {{ with .Site.Menus.main }}
      {{ $about := where . "Name" "About" }}
      {{ if gt (len $about) 0 }}
        {{ $authorLink = (index $about 0).URL | relLangURL }}
      {{ end }}
    {{ end }}
    {{ $langs := slice (dict "label" (.Lang | upper) "url" .RelPermalink) }}
    {{ with .Translations }}
      {{ range . }}
        {{ $langs = $langs | append (dict "label" (.Lang | upper) "url" .RelPermalink) }}
      {{ end }}
    {{ end }}

    <header class="article-hero article-hero--stack">
      <h1 class="article-title">{{ .Title }}</h1>
      <div class="share-block share-block--mobile">
        {{ partial "share-buttons.html" . }}
      </div>
      <div class="article-meta article-meta--stack">
        <div class="meta-row">date: <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</time></div>
        <div class="meta-row">author: {{ if $authorLink }}<a class="meta-link" href="{{ $authorLink | relLangURL }}">{{ $authorHandle }}</a>{{ else }}{{ $authorHandle }}{{ end }}</div>
        {{ with .Params.tags }}<div class="meta-row">tags: [{{ range $i, $tag := . }}{{ if $i }}, {{ end }}<a class="meta-link" href="{{ "/tags/" | relLangURL }}{{ urlize $tag }}">{{ $tag }}</a>{{ end }}]</div>{{ end }}
        {{ if gt (len $langs) 1 }}
        <div class="meta-row">languages: [
          {{ range $i, $l := $langs }}
            {{ if $i }}, {{ end }}
            {{ if eq $.Lang (lower $l.label) | or (eq $l.label (upper $.Lang)) }}
              <span class="meta-lang-current">{{ $l.label }}</span>
            {{ else }}
              <a class="meta-link" href="{{ $l.url }}">{{ $l.label }}</a>
            {{ end }}
          {{ end }}
        ]</div>
        {{ end }}
      </div>
    </header>

    {{ with .Params.image }}
      <figure class="hero-cover">
        <img src="{{ . | absURL }}" alt="">
      </figure>
    {{ end }}

    <div class="meta-separator" aria-hidden="true">---</div>

    {{ if $hasToc }}
    <details class="toc-inline" id="{{ $tocId }}">
      <summary>{{ i18n "toc_summary" | default "Table of contents" }}</summary>
      {{ partial "toc.html" . }}
    </details>
    <div class="toc-modal" id="{{ $tocModalId }}" hidden>
      <div class="toc-modal__handle" aria-hidden="true"></div>
      <div class="toc-modal__header">
        <span>{{ i18n "toc_title" | default "Contents" }}</span>
        <button type="button" class="toc-modal__close" data-toc-close aria-label="Close">&times;</button>
      </div>
      <div class="toc-modal__body">
        {{ partial "toc.html" . }}
      </div>
    </div>
    <div class="toc-modal__overlay" hidden></div>
    {{ end }}

    <div class="article-body">
      {{ .Content }}
    </div>

    <div class="article-footer">
      <a class="muted" href="{{ "/blog/" | relLangURL }}">← Back to blog</a>
      {{ if or .PrevInSection .NextInSection }}
      <div class="article-nav">
        {{ with .PrevInSection }}<a class="nav-arrow" href="{{ .RelPermalink }}">← {{ .Title }}</a>{{ end }}
        {{ with .NextInSection }}<a class="nav-arrow" href="{{ .RelPermalink }}">{{ .Title }} →</a>{{ end }}
      </div>
      {{ end }}
    </div>
  </article>

  {{ if $hasToc }}
    <aside class="toc-desktop">
      {{ partial "toc.html" . }}
      {{ $gh := .Site.Params.author.github | default "" }}
      {{ $tw := .Site.Params.author.twitter | default "" }}
      <div class="sidebar-profile">
        <a class="sidebar-profile__name" href="{{ "/about/" | relLangURL }}">{{ .Site.Params.author.name | default .Site.Title }}</a>
        <div class="sidebar-profile__links">
          {{ if $gh }}<a class="social-btn" href="https://github.com/{{ $gh }}" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.1.82-.26.82-.58 0-.29-.01-1.05-.02-2.06-3.34.73-4.04-1.61-4.04-1.61-.54-1.37-1.32-1.73-1.32-1.73-1.08-.74.08-.73.08-.73 1.19.08 1.81 1.22 1.81 1.22 1.06 1.8 2.79 1.28 3.47.98.1-.77.42-1.28.76-1.58-2.66-.3-5.47-1.34-5.47-5.95 0-1.32.47-2.4 1.24-3.25-.13-.3-.54-1.52.12-3.16 0 0 1.01-.32 3.3 1.24a11.5 11.5 0 0 1 6 0c2.28-1.56 3.29-1.24 3.29-1.24.66 1.64.25 2.86.12 3.16.77.85 1.23 1.93 1.23 3.25 0 4.62-2.81 5.64-5.49 5.94.43.37.81 1.11.81 2.24 0 1.62-.02 2.93-.02 3.33 0 .32.21.7.83.58A12 12 0 0 0 12 .5Z"/></svg></a>{{ end }}
          {{ if $tw }}<a class="social-btn" href="https://x.com/{{ $tw }}" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h5.3l3.4 4.8L14.8 3H21l-6.8 9.2L21 21h-5.3l-3.7-5.2L8.2 21H3l6.8-8.9L3 3z"/></svg></a>{{ end }}
        </div>
      </div>
      <div class="share-block share-block--desktop">
        {{ partial "share-buttons.html" . }}
      </div>
    </aside>
  {{ end }}
</div>

{{ if $hasToc }}
  {{ $tocLabel := cond (eq .Site.Language.Lang "ja") "目次" "TOC" }}
  <button type="button" class="mobile-toc-fab" data-toc-modal="#{{ $tocModalId }}" aria-pressed="false">
    <span class="mobile-toc-fab__label">{{ $tocLabel }}</span>
    <svg class="mobile-toc-fab__icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 14l6-6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
{{ end }}
{{ end }}
