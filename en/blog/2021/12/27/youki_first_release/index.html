<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Hello, youki! | utam0k</title><meta name=description content="First release of youki, an OCI container runtime written in Rust"><meta property="og:description" content="First release of youki, an OCI container runtime written in Rust"><meta property="og:type" content="article"><meta property="og:site_name" content="utam0k"><meta property="og:url" content="https://www.utam0k.jp/en/blog/2021/12/27/youki_first_release/"><meta property="og:title" content="Hello, youki!"><meta property="og:image" content="https://www.utam0k.jp/blog/2021/12/27/youki_first_release/ogp.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.utam0k.jp/blog/2021/12/27/youki_first_release/ogp.png"><link rel=alternate type=application/rss+xml href=https://www.utam0k.jp/en/index.xml><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/hack-font/3.3.0/web/hack.min.css crossorigin=anonymous><link rel=stylesheet href=https://www.utam0k.jp/css/main.min.c4f5217ffc943dd06bf5e9285a13579c16ea18a4b3f8d0ef661b70f60a2cbd3e.css integrity="sha256-xPUhf/yUPdBr9ekoWhNXnBbqGKSz+NDvZhtw9gosvT4="><script>(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),n=e=>{const s=document.querySelectorAll(".theme-option");s.forEach(t=>{const n=t.dataset.mode===e;t.setAttribute("aria-pressed",n?"true":"false")});const t=document.querySelector(".theme-toggle");t&&t.setAttribute("aria-pressed",e==="dark"?"true":"false");const o=document.querySelectorAll(".theme-choice");o.forEach(t=>t.setAttribute("aria-checked",t.dataset.mode===e?"true":"false"));const n=document.querySelector("[data-theme-icon]");if(n){const t=e==="system"?document.documentElement.dataset.theme||"light":e;n.dataset.state=t}},s=t=>t==="system"?e.matches?"dark":"light":t,t=e=>{const t=s(e);document.documentElement.dataset.theme=t,document.body&&(document.body.dataset.theme=t,document.body.classList.toggle("theme-dark",t==="dark"),document.body.classList.toggle("theme-light",t==="light")),n(e)},o=()=>{const e=localStorage.getItem("color-scheme"),n=e||"system";t(n)};e.addEventListener("change",e=>{const n=localStorage.getItem("color-scheme");(!n||n==="system")&&t("system")}),window.__setTheme=e=>{const n=e||(document.documentElement.dataset.theme==="dark"?"light":"dark");localStorage.setItem("color-scheme",n),t(n)},window.__toggleTheme=()=>window.__setTheme(),window.__toggleThemeMenu=e=>{const t=e?.nextElementSibling;if(!t)return;const n=!t.hidden;document.querySelectorAll(".theme-popover").forEach(e=>e.hidden=!0),document.querySelectorAll(".theme-trigger").forEach(e=>e.setAttribute("aria-expanded","false")),n||(t.hidden=!1,e.setAttribute("aria-expanded","true"))},document.addEventListener("click",e=>{const t=document.querySelector(".theme-popover");if(!t)return;if(e.target.closest(".theme-menu"))return;t.hidden=!0;const n=document.querySelector(".theme-trigger");n?.setAttribute("aria-expanded","false")}),window.__toggleLangMenu=e=>{const t=e?.nextElementSibling;if(!t)return;const n=!t.hidden;document.querySelectorAll(".lang-popover").forEach(e=>e.hidden=!0),document.querySelectorAll(".lang-trigger").forEach(e=>e.setAttribute("aria-expanded","false")),n||(t.hidden=!1,e.setAttribute("aria-expanded","true"))},window.__switchLang=(e)=>{if(!e)return;window.location.href=e},document.addEventListener("click",e=>{const t=document.querySelector(".lang-popover");if(!t)return;if(e.target.closest(".lang-menu"))return;t.hidden=!0;const n=document.querySelector(".lang-trigger");n?.setAttribute("aria-expanded","false")}),o(),document.addEventListener("DOMContentLoaded",()=>{const t=document.documentElement.dataset.theme||(e.matches?"dark":"light");n(t)})})()</script><meta name=generator content="Hugo 0.152.2"><script async src="https://www.googletagmanager.com/gtag/js?id=G-F75YLEHSJN"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F75YLEHSJN")</script></head><body class=page data-has-toc=true><div class=page-shell><header class=site-header><a class=brand href=https://www.utam0k.jp/en/><span class=brand-mark aria-hidden=true style=background-image:url(https://www.utam0k.jp/img/logo.png)></span><div class=brand-text><span class=brand-name>Toru Komatsu</span>
<span class=brand-tagline>@utam0k</span></div></a><div class=header-actions><nav class=main-nav aria-label=Primary><a class="nav-item is-active" href=https://www.utam0k.jp/en/blog/>Blog</a>
<a class=nav-item href=https://www.utam0k.jp/en/tmp/>/tmp</a>
<a class=nav-item href=https://www.utam0k.jp/en/slides/>Slides</a>
<a class=nav-item href=https://www.utam0k.jp/en/page/about/>About</a></nav><span class=header-divider aria-hidden=true></span><div class=header-social><a class=social-btn href=https://github.com/utam0k target=_blank rel="noopener noreferrer" aria-label=GitHub><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .5A12 12 0 008.21 23.9c.6.1.82-.26.82-.58.0-.29-.01-1.05-.02-2.06-3.34.73-4.04-1.61-4.04-1.61-.54-1.37-1.32-1.73-1.32-1.73-1.08-.74.08-.73.08-.73 1.19.08 1.81 1.22 1.81 1.22 1.06 1.8 2.79 1.28 3.47.98.1-.77.42-1.28.76-1.58-2.66-.3-5.47-1.34-5.47-5.95.0-1.32.47-2.4 1.24-3.25-.13-.3-.54-1.52.12-3.16.0.0 1.01-.32 3.3 1.24a11.5 11.5.0 016 0c2.28-1.56 3.29-1.24 3.29-1.24.66 1.64.25 2.86.12 3.16.77.85 1.23 1.93 1.23 3.25.0 4.62-2.81 5.64-5.49 5.94.43.37.81 1.11.81 2.24.0 1.62-.02 2.93-.02 3.33.0.32.21.7.83.58A12 12 0 0012 .5z"/></svg>
</a><a class=social-btn href=https://x.com/utam0k target=_blank rel="noopener noreferrer" aria-label="X (Twitter)"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h5.3l3.4 4.8L14.8 3H21l-6.8 9.2L21 21h-5.3L12 15.8 8.2 21H3l6.8-8.9L3 3z"/></svg></a></div><span class=header-divider aria-hidden=true></span><div class=lang-menu><button class=lang-trigger type=button aria-haspopup=true aria-expanded=false onclick=window.__toggleLangMenu&&window.__toggleLangMenu(this)>
<span class=lang-trigger__label>EN</span></button><div class=lang-popover hidden role=menu><button class=lang-choice type=button data-lang=JA aria-checked=false role=menuitemradio onclick='window.__switchLang&&window.__switchLang("/blog/2021/12/27/youki_first_release/","JA")'>æ—¥æœ¬èª</button>
<button class=lang-choice type=button data-lang=EN aria-checked=true role=menuitemradio onclick='window.__switchLang&&window.__switchLang("/en/","EN")'>English</button></div></div><div class=theme-menu><button class=theme-trigger type=button aria-haspopup=true aria-expanded=false onclick=window.__toggleThemeMenu&&window.__toggleThemeMenu(this)>
<span class=theme-trigger__icon aria-hidden=true data-theme-icon data-state=system></span>
<span class=sr-only data-theme-label>Theme</span></button><div class=theme-popover hidden><button class=theme-choice type=button data-mode=system aria-checked=false role=menuitemradio onclick='window.__setTheme&&window.__setTheme("system")'>Auto (System)</button>
<button class=theme-choice type=button data-mode=light aria-checked=false role=menuitemradio onclick='window.__setTheme&&window.__setTheme("light")'>Light</button>
<button class=theme-choice type=button data-mode=dark aria-checked=false role=menuitemradio onclick='window.__setTheme&&window.__setTheme("dark")'>Dark</button></div></div><button class=menu-toggle type=button aria-expanded=false aria-controls=mobile-menu data-menu-toggle>
<span class=sr-only>Menu</span>
<span class=menu-toggle__icon aria-hidden=true><span></span></span></button></div><div class=mobile-menu id=mobile-menu hidden><div class=mobile-menu__header><span class=mobile-menu__title>Menu</span>
<button class=menu-close type=button aria-label="Close menu" data-menu-close>
<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button></div><nav class=mobile-menu__links aria-label="Primary mobile"><a class="mobile-menu__item is-active" href=https://www.utam0k.jp/en/blog/>Blog</a>
<a class=mobile-menu__item href=https://www.utam0k.jp/en/tmp/>/tmp</a>
<a class=mobile-menu__item href=https://www.utam0k.jp/en/slides/>Slides</a>
<a class=mobile-menu__item href=https://www.utam0k.jp/en/page/about/>About</a></nav><div class=mobile-menu__footer><div class=mobile-menu__langs><button class=lang-chip type=button onclick='window.__switchLang&&window.__switchLang("/blog/2021/12/27/youki_first_release/","JA")'>JA</button>
<button class="lang-chip is-active" type=button onclick='window.__switchLang&&window.__switchLang("/en/","EN")'>EN</button></div><div class=mobile-menu__icons><button class=social-btn type=button aria-label="Toggle theme" onclick=window.__toggleTheme&&window.__toggleTheme()>
<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="4" fill="currentColor"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
</button>
<a class=social-btn href=https://github.com/utam0k target=_blank rel="noopener noreferrer" aria-label=GitHub><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .5A12 12 0 008.21 23.9c.6.1.82-.26.82-.58.0-.29-.01-1.05-.02-2.06-3.34.73-4.04-1.61-4.04-1.61-.54-1.37-1.32-1.73-1.32-1.73-1.08-.74.08-.73.08-.73 1.19.08 1.81 1.22 1.81 1.22 1.06 1.8 2.79 1.28 3.47.98.1-.77.42-1.28.76-1.58-2.66-.3-5.47-1.34-5.47-5.95.0-1.32.47-2.4 1.24-3.25-.13-.3-.54-1.52.12-3.16.0.0 1.01-.32 3.3 1.24a11.5 11.5.0 016 0c2.28-1.56 3.29-1.24 3.29-1.24.66 1.64.25 2.86.12 3.16.77.85 1.23 1.93 1.23 3.25.0 4.62-2.81 5.64-5.49 5.94.43.37.81 1.11.81 2.24.0 1.62-.02 2.93-.02 3.33.0.32.21.7.83.58A12 12 0 0012 .5z"/></svg></a>
<a class=social-btn href=https://x.com/utam0k target=_blank rel="noopener noreferrer" aria-label="X (Twitter)"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h5.3l3.4 4.8L14.8 3H21l-6.8 9.2L21 21h-5.3L12 15.8 8.2 21H3l6.8-8.9L3 3z"/></svg></a></div></div></div><div class=mobile-menu__overlay data-menu-overlay hidden></div></header><main class=layout><div class=article-layout><article class=article><header class="article-hero article-hero--stack"><h1 class=article-title>Hello, youki!</h1><div class="share-block share-block--mobile"><div class=toc-share aria-label="Share this post"><button type=button class="share-btn share-btn--native" data-share-native data-share-url=https://www.utam0k.jp/en/blog/2021/12/27/youki_first_release/ data-share-title="Hello, youki!" aria-label="Native share" hidden>
<svg viewBox="0 -960 960 960" aria-hidden="true"><path d="M680-80q-50 0-85-35t-35-85q0-6 3-28L282-392q-16 15-37 23.5t-45 8.5q-50 0-85-35t-35-85 35-85 85-35q24 0 45 8.5t37 23.5l281-164q-2-7-2.5-13.5T560-760q0-50 35-85t85-35 85 35 35 85-35 85-85 35q-24 0-45-8.5T598-672L317-508q2 7 2.5 13.5t.5 14.5-.5 14.5T317-452l281 164q16-15 37-23.5t45-8.5q50 0 85 35t35 85-35 85-85 35zm0-80q17 0 28.5-11.5T720-2e2t-11.5-28.5T680-240t-28.5 11.5T640-2e2t11.5 28.5T680-160zM2e2-440q17 0 28.5-11.5T240-480t-11.5-28.5T2e2-520t-28.5 11.5T160-480t11.5 28.5T2e2-440zm480-280q17 0 28.5-11.5T720-760t-11.5-28.5T680-8e2t-28.5 11.5T640-760t11.5 28.5T680-720zm0 520zM2e2-480zm480-280z"/></svg>
<span class=sr-only>Share</span>
</button>
<a class=share-btn href="https://twitter.com/intent/tweet?text=Hello%2c%20youki%21&url=https%3a%2f%2fwww.utam0k.jp%2fen%2fblog%2f2021%2f12%2f27%2fyouki_first_release%2f" target=_blank rel="noopener noreferrer"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h5.3l3.4 4.8L14.8 3H21l-6.8 9.2L21 21h-5.3L12 15.8 8.2 21H3l6.8-8.9L3 3z"/></svg>
<span class=sr-only>Share on X</span>
</a><a class=share-btn href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fwww.utam0k.jp%2fen%2fblog%2f2021%2f12%2f27%2fyouki_first_release%2f&title=Hello%2c%20youki%21" target=_blank rel="noopener noreferrer"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20.47.0C22.42.0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42.0 20.47V3.53C0 1.58 1.58.0 3.53.0h16.94zM8.61 17.25c1.2.0 2.06-.04 2.58-.12.53-.08.98-.22 1.32-.41.45-.23.78-.56 1.02-.99.24-.43.36-.91.36-1.48.0-.78-.21-1.4-.63-1.87-.42-.48-.99-.74-1.74-.79.66-.18 1.16-.45 1.46-.81.32-.34.47-.82.47-1.42.0-.48-.1-.88-.3-1.26-.21-.36-.5-.65-.88-.87-.35-.2-.74-.32-1.22-.4-.46-.08-1.29-.12-2.48-.12H5.65v10.46H8.6zm.74-4.19c.7.0 1.18.09 1.44.27.27.18.4.5.4.93.0.4-.14.69-.42.86-.27.18-.76.25-1.44.25H8.31v-2.31h1.03zm8.66.71V6.71h-2.46v7.06h2.46zM8.93 9.08c.71.0 1.19.08 1.43.24.25.16.37.44.37.84.0.38-.13.65-.39.8-.27.16-.75.24-1.45.24h-.57V9.08h.61z"/></svg>
<span class=sr-only>ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</span>
</a><a class=share-btn href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.utam0k.jp%2fen%2fblog%2f2021%2f12%2f27%2fyouki_first_release%2f&title=Hello%2c%20youki%21" target=_blank rel="noopener noreferrer"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20.45 3.5H3.55A1.55 1.55.0 002 5.05v13.9A1.55 1.55.0 003.55 20.5h16.9A1.55 1.55.0 0022 18.95V5.05A1.55 1.55.0 0020.45 3.5zM7.14 18.1H4.54V9.88h2.6V18.1zm-1.3-9.36a1.51 1.51.0 110-3.02 1.51 1.51.0 010 3.02zM19 18.1h-2.6v-4.96c0-1.18-.42-1.99-1.48-1.99-.81.0-1.3.55-1.51 1.09-.08.19-.1.46-.1.73v5.13H10.7s.03-8.32.0-9.18h2.6v1.3c.35-.54.98-1.31 2.39-1.31 1.74.0 3.31 1.13 3.31 3.56V18.1z"/></svg>
<span class=sr-only>Share on LinkedIn</span></a></div></div><div class="article-meta article-meta--stack"><div class=meta-row>date: <time datetime=2021-12-27>Mon, 27 Dec 2021 00:00:00 +0900</time></div><div class=meta-row>author: <a class=meta-link href=https://www.utam0k.jp/en/page/about/>@utam0k</a></div><div class=meta-row>tags: [<a class=meta-link href=https://www.utam0k.jp/en/tags/rust>rust</a>, <a class=meta-link href=https://www.utam0k.jp/en/tags/youki>youki</a>]</div><div class=meta-row>languages: [
<span class=meta-lang-current>EN</span>
,
<a class=meta-link href=https://www.utam0k.jp/blog/2021/12/27/youki_first_release/>JA</a>
]</div></div></header><div class=meta-separator aria-hidden=true>---</div><details class=toc-inline id=mobile-toc-inline><summary>Show table of contents</summary><nav class=toc aria-label="Table of contents"><p class=toc__title>Contents</p><div class=toc__body><nav id=TableOfContents><ul><li><ul><li><a href=#-what-is-youki>ğŸ¤” What is youki?</a></li><li><a href=#why-another-container-runtime>Why another container runtime?</a></li><li><a href=#implementation-status>Implementation status</a></li><li><a href=#how-to-get-started>How to get started</a></li><li><a href=#-motivation>ğŸ’ª Motivation</a></li><li><a href=#-join-youki>ğŸ¤ Join youki!</a></li><li><a href=#-a-short-history-of-youki>ğŸ‘£ A short history of youki</a></li><li><a href=#-acknowledgement>ğŸ¥° Acknowledgement</a></li><li><a href=#-conclusion>ğŸ’¬ Conclusion</a></li></ul></li></ul></nav></div></nav></details><div class=toc-modal id=mobile-toc-modal hidden><div class=toc-modal__handle aria-hidden=true></div><div class=toc-modal__header><span>Contents</span>
<button type=button class=toc-modal__close data-toc-close aria-label=Close>&#215;</button></div><div class=toc-modal__body><nav class=toc aria-label="Table of contents"><p class=toc__title>Contents</p><div class=toc__body><nav id=TableOfContents><ul><li><ul><li><a href=#-what-is-youki>ğŸ¤” What is youki?</a></li><li><a href=#why-another-container-runtime>Why another container runtime?</a></li><li><a href=#implementation-status>Implementation status</a></li><li><a href=#how-to-get-started>How to get started</a></li><li><a href=#-motivation>ğŸ’ª Motivation</a></li><li><a href=#-join-youki>ğŸ¤ Join youki!</a></li><li><a href=#-a-short-history-of-youki>ğŸ‘£ A short history of youki</a></li><li><a href=#-acknowledgement>ğŸ¥° Acknowledgement</a></li><li><a href=#-conclusion>ğŸ’¬ Conclusion</a></li></ul></li></ul></nav></div></nav></div></div><div class=toc-modal__overlay hidden></div><div class=article-body><div class=blankslate><p class="my-12 h1 text-underline text-center text-mono">Hello, youki!</p><p>Hi, I'm Toru Komatsu(<a href=https://twitter.com/utam0k target=_blank rel="noopener noreferrer">@utam0k</a>), first committer of youki.<br>This article was written in celebration of youki's v0.0.1 release</p><a href=https://github.com/containers/youki/releases/tag/v0.0.1 target=_blank rel="noopener noreferrer" class="btn-legacy btn-primary" type=button>View Relase Note</a></div><h2 id=-what-is-youki>ğŸ¤” What is youki?</h2><p>Youki is a low level container runtime written in Rust that implements the <a href=https://github.com/opencontainers/runtime-spec/blob/main/spec.md>OCI Runtime Specification</a>. Simply put, youki is a commandline tool that can create containers. Other runtimes in the same category you might have heard about are <a href=https://github.com/opencontainers/runc>runc</a> and <a href=https://github.com/containers/crun>crun</a>. When you create a container using Docker or Podman the actual container creation is delegated to a tool like youki.</p><div class=my-4><center><a href=https://github.com/containers/youki><img src=link_card_youki.svg></a></center></div><h2 id=why-another-container-runtime>Why another container runtime?</h2><p>Currently many container tools are implemented in Go which requires special handling when it comes to implementing a container runtime. Runc for example embeds a C program into its exectuable that handles setting up the namespaces as this is not possible in Go due to the multithreaded nature of the Go runtime.</p><p>On the other hand C could be used as a implementation language but this comes at the cost of memory safety and in addition C lacks high level language constructs that we have come to expect from a modern language.</p><p>Therefore while Go and C are perfectly fine languages, for this particular use case we believe that Rust with its cross section of low level control, memory safety and high level abstractions is uniquely suited for implementing a container runtime.</p><p>Youki has the potential to be faster and use less memory than runc, and therefore work in environments with tight memory usage requirements. Here is a simple benchmark of a container from creation to deletion. As with all benchmarks, this might not be representative of your own workloads</p><center><table><thead><tr><th style=text-align:center>Runtime</th><th style=text-align:center>Time (mean Â± Ïƒ)</th><th style=text-align:center>Range (min â€¦ max)</th></tr></thead><tbody><tr><td style=text-align:center>youki</td><td style=text-align:center>198.4 ms Â± 52.1 ms</td><td style=text-align:center>97.2 ms â€¦ 296.1 ms</td></tr><tr><td style=text-align:center>runc</td><td style=text-align:center>352.3 ms Â± 53.3 ms</td><td style=text-align:center>248.3 ms â€¦ 772.2 ms</td></tr><tr><td style=text-align:center>crun</td><td style=text-align:center>153.5 ms Â± 21.6 ms</td><td style=text-align:center>80.9 ms â€¦ 196.6 ms</td></tr></tbody></table></center><details><summary>Details about the benchmark</summary><ul><li>A command used for the benchmark<div class=code-block><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> hyperfine --prepare <span class=s1>&#39;sudo sync; echo 3 | sudo tee /proc/sys/vm/drop_caches&#39;</span> --warmup <span class=m>10</span> --min-runs <span class=m>100</span> <span class=s1>&#39;sudo ./youki create -b tutorial a &amp;&amp; sudo ./youki start a &amp;&amp; sudo ./youki delete -f a&#39;</span>
</span></span></code></pre></div></div></li><li>Enviroment<div class=code-block><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> ./youki info
</span></span><span class=line><span class=cl><span class=go>Version           0.0.1
</span></span></span><span class=line><span class=cl><span class=go>Kernel-Release    5.11.0-41-generic
</span></span></span><span class=line><span class=cl><span class=go>Kernel-Version    #45-Ubuntu SMP Fri Nov 5 11:37:01 UTC 2021
</span></span></span><span class=line><span class=cl><span class=go>Architecture      x86_64
</span></span></span><span class=line><span class=cl><span class=go>Operating System  Ubuntu 21.04
</span></span></span><span class=line><span class=cl><span class=go>Cores             12
</span></span></span><span class=line><span class=cl><span class=go>Total Memory      32025
</span></span></span><span class=line><span class=cl><span class=go>Cgroup setup      hybrid
</span></span></span><span class=line><span class=cl><span class=go>Cgroup mounts
</span></span></span><span class=line><span class=cl><span class=go>  blkio           /sys/fs/cgroup/blkio
</span></span></span><span class=line><span class=cl><span class=go>  cpu             /sys/fs/cgroup/cpu,cpuacct
</span></span></span><span class=line><span class=cl><span class=go>  cpuacct         /sys/fs/cgroup/cpu,cpuacct
</span></span></span><span class=line><span class=cl><span class=go>  cpuset          /sys/fs/cgroup/cpuset
</span></span></span><span class=line><span class=cl><span class=go>  devices         /sys/fs/cgroup/devices
</span></span></span><span class=line><span class=cl><span class=go>  freezer         /sys/fs/cgroup/freezer
</span></span></span><span class=line><span class=cl><span class=go>  hugetlb         /sys/fs/cgroup/hugetlb
</span></span></span><span class=line><span class=cl><span class=go>  memory          /sys/fs/cgroup/memory
</span></span></span><span class=line><span class=cl><span class=go>  net_cls         /sys/fs/cgroup/net_cls,net_prio
</span></span></span><span class=line><span class=cl><span class=go>  net_prio        /sys/fs/cgroup/net_cls,net_prio
</span></span></span><span class=line><span class=cl><span class=go>  perf_event      /sys/fs/cgroup/perf_event
</span></span></span><span class=line><span class=cl><span class=go>  pids            /sys/fs/cgroup/pids
</span></span></span><span class=line><span class=cl><span class=go>  unified         /sys/fs/cgroup/unified
</span></span></span><span class=line><span class=cl><span class=go>CGroup v2 controllers
</span></span></span><span class=line><span class=cl><span class=go>  cpu             detached
</span></span></span><span class=line><span class=cl><span class=go>  cpuset          detached
</span></span></span><span class=line><span class=cl><span class=go>  hugetlb         detached
</span></span></span><span class=line><span class=cl><span class=go>  io              detached
</span></span></span><span class=line><span class=cl><span class=go>  memory          detached
</span></span></span><span class=line><span class=cl><span class=go>  pids            detached
</span></span></span><span class=line><span class=cl><span class=go>  device          attached
</span></span></span><span class=line><span class=cl><span class=go>Namespaces        enabled
</span></span></span><span class=line><span class=cl><span class=go>  mount           enabled
</span></span></span><span class=line><span class=cl><span class=go>  uts             enabled
</span></span></span><span class=line><span class=cl><span class=go>  ipc             enabled
</span></span></span><span class=line><span class=cl><span class=go>  user            enabled
</span></span></span><span class=line><span class=cl><span class=go>  pid             enabled
</span></span></span><span class=line><span class=cl><span class=go>  network         enabled
</span></span></span><span class=line><span class=cl><span class=go>  cgroup          enabled
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> ./youki --version
</span></span><span class=line><span class=cl><span class=go>youki version 0.0.1
</span></span></span><span class=line><span class=cl><span class=go>commit: 0.0.1-0-0be33bf
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> runc -v
</span></span><span class=line><span class=cl><span class=go>runc version 1.0.0-rc93
</span></span></span><span class=line><span class=cl><span class=go>commit: 12644e614e25b05da6fd08a38ffa0cfe1903fdec
</span></span></span><span class=line><span class=cl><span class=go>spec: 1.0.2-dev
</span></span></span><span class=line><span class=cl><span class=go>go: go1.13.15
</span></span></span><span class=line><span class=cl><span class=go>libseccomp: 2.5.1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> crun --version
</span></span><span class=line><span class=cl><span class=go>crun version 0.19.1.45-4cc7
</span></span></span><span class=line><span class=cl><span class=go>commit: 4cc7fa1124cce75dc26e12186d9cbeabded2b710
</span></span></span><span class=line><span class=cl><span class=go>spec: 1.0.0
</span></span></span><span class=line><span class=cl><span class=go>+SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL
</span></span></span></code></pre></div></div></li></ul></details><h2 id=implementation-status>Implementation status</h2><p>A container runtime needs to implement many features that users have come to expect from a container runtime, that have not yet been incorporated into the OCI Runtime Specification. Despite this being the first release of youki, many features have already been implemented.</p><table><thead><tr><th style=text-align:center>Feature</th><th style=text-align:center>Description</th><th style=text-align:center>State</th></tr></thead><tbody><tr><td style=text-align:center>Docker</td><td style=text-align:center>Running via Docker</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Podman</td><td style=text-align:center>Running via Podman</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>pivot_root</td><td style=text-align:center>Change the root directory</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Mounts</td><td style=text-align:center>Mount files and directories to container</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Namespaces</td><td style=text-align:center>Isolation of various resources</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Capabilities</td><td style=text-align:center>Limiting root privileges</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Cgroups v1</td><td style=text-align:center>Resource limitations, etc</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Cgroups v2</td><td style=text-align:center>Improved version of v1</td><td style=text-align:center>Support is complete except for devices. WIP on <a href=https://github.com/containers/youki/issues/78>#78</a></td></tr><tr><td style=text-align:center>Systemd cgroup driver</td><td style=text-align:center>Setting up a cgroup using systemd</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Seccomp</td><td style=text-align:center>Filtering system calls</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Hooks</td><td style=text-align:center>Add custom processing during container creation</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>Rootless</td><td style=text-align:center>Running a container without root privileges</td><td style=text-align:center>âœ…</td></tr><tr><td style=text-align:center>OCI Compliance</td><td style=text-align:center>Compliance with OCI Runtime Spec</td><td style=text-align:center>âœ… 50 out of 50 test cases passing</td></tr></tbody></table><h2 id=how-to-get-started>How to get started</h2><p>Download youki from <a href=https://github.com/containers/youki/releases/tag/v0.0.1>the release</a> page and follow the <a href=https://github.com/containers/youki#tutorial>tutorial</a>.
See <a href=https://containers.github.io/youki/>the mdbook</a> for more details.</p><h2 id=-motivation>ğŸ’ª Motivation</h2><p>Why do we keep implementing youki?</p><ul><li><p>Contribution to the container runtime community<br>We are trying to provide as much of the crates used to make youki to the community. Currently we are providing <a href=https://github.com/containers/oci-spec-rs>containers/oci-spec-rs</a> as a crate, separated from youki's main code. We have already crates available for <a href=https://github.com/containers/youki/tree/main/crates/libcgroups>cgroups</a>, <a href=https://github.com/containers/youki/tree/main/crates/libcontainer>container creation</a>, <a href=https://github.com/containers/youki/tree/main/crates/libseccomp>seccomp</a> and <a href=https://github.com/containers/youki/tree/main/crates/liboci-cli>oci-cli parsing</a> which will be released at a later point in time.</p></li><li><p>Explore<br>Youki does not provide any support for older kernels. By doing so, it has the potential to use new features such as <code>io_uring</code>, <code>clone3</code> and <code>webassembly</code>.</p></li><li><p>Fun
We have fun implementing this. In fact, this might be the most important part.</p></li></ul><h2 id=-join-youki>ğŸ¤ Join youki!</h2><p>Youki is always looking for people who want to learn about container runtimes in Rust, and for your input.</p><ul><li><a href=https://github.com/containers/youki/issues/10>Issues that allow people to post their opinions and ideas</a></li><li><a href=https://discord.gg/zHnyXKSQFD>Discord</a></li><li><a href=https://twitter.com/utam0k>@utam0k</a></li></ul><p>We also have <a href="https://github.com/containers/youki/issues?q=is%3Aopen+is%3Aissue+label%3A%22good+first+issue%22">good first issue</a> as the first way to participate in development.
If you cannot find a good first issue that fits you, please ask on Discord or Twitter.</p><h2 id=-a-short-history-of-youki>ğŸ‘£ A short history of youki</h2><div class=TimelineItem><div class="TimelineItem-badge color-bg-danger-emphasis color-fg-on-emphasis"><svg width="16" height="16" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747.0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746.0-3.332.477-4.5 1.253"/></svg></div><div class=TimelineItem-body>utam0k found <a href=https://www.amazon.co.jp/dp/4297118378>a book about Docker & Kubernetes</a> written by <a href=https://twitter.com/TokunagaKohei>Kohei Tokunaga</a> in Japanese</div></div><div class=TimelineItem><div class="TimelineItem-badge color-bg-success-emphasis color-fg-on-emphasis"><svg class="octicon octicon-git-commit" viewBox="0 0 14 16" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86.0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3s3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22.0-2.2-.98-2.2-2.2S5.78 5.8 7 5.8s2.2.98 2.2 2.2-.98 2.2-2.2 2.2z"/></svg></div><div class=TimelineItem-body>Studied <a href=https://github.com/oracle/railcar>railcar</a> which is implemented by Oracle and already archived</div></div><div class=TimelineItem><div class="TimelineItem-badge color-bg-accent-emphasis color-fg-on-emphasis"><svg weight="16" height="16" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16 2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg></div><div class=TimelineItem-body>Started implementing the container runtime in Rust, which later became youki</div></div><div class=TimelineItem><div class="TimelineItem-badge color-bg-success-emphasis color-fg-on-emphasis"><svg weight="16" height="16" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684 6.632 3.316m-6.632-6 6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg></div><div class=TimelineItem-body>Attracted attention of developers on <a href=https://www.reddit.com/r/programming/comments/niv8cg/youki_a_container_runtime_in_rust_passed_all_the/>Reddit</a> and elsewhere</div></div><div class=TimelineItem><div class="TimelineItem-badge color-bg-success-emphasis color-fg-on-emphasis"><svg weight="16" height="16" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zm10 0a2 2 0 11-4 0 2 2 0 014 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4A1 1 0 003 6v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/></svg></div><div class=TimelineItem-body>Transfer from utam0k's personal account to the containers organization<blockquote class=twitter-tweet><p lang=en dir=ltr>ğŸ‰ I joined the containers organization, which is developing podman and crun. And I moved youki under containers.<a href=https://t.co/dMTFxrZKUZ>https://t.co/dMTFxrZKUZ</a> <a href=https://t.co/qx2nnvyvxw>pic.twitter.com/qx2nnvyvxw</a></p>&mdash; utam0k (@utam0k) <a href="https://twitter.com/utam0k/status/1400763774995374085?ref_src=twsrc%5Etfw">June 4, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></div><div class=TimelineItem><div class="TimelineItem-badge color-bg-success-emphasis color-fg-on-emphasis"><svg weight="16" height="16" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5A4 4 0 115 7a4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg></div><div class=TimelineItem-body>More attention, more developers</div></div><div class=TimelineItem><div class="TimelineItem-badge color-bg-success-emphasis color-fg-on-emphasis"><svg weight="16" height="16" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16 2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg></div><div class=TimelineItem-body>First release of youki</div></div><h2 id=-acknowledgement>ğŸ¥° Acknowledgement</h2><p>Thanks to all the wonderful collaborators.<br><a href=https://github.com/Furisto>Thomas Schubart</a>, <a href=https://github.com/yihuaf>yihuaf</a>, <a href=https://github.com/YJDoc2>YJDoc2</a>, <a href=https://github.com/tommady>tommady</a>, <a href=https://github.com/chenyukang>Yukang</a> and <a href=https://github.com/tsturzl>Travis Sturzl</a></p><p>Thanks to the members of <a href=https://github.com/containers>containers</a> for their cooperation.<br>Thank you especially to <a href=https://github.com/saschagrunert>Sascha Grunert</a>, <a href=https://github.com/giuseppe>Giuseppe Scrivano</a> and <a href=https://github.com/rhatdan>Daniel J Walsh</a>.</p><p>Thanks to all the people who already contributed!</p><figure><img src=https://www.utam0k.jp/blog/2021/12/27/youki_first_release/contributors.svg></figure><p>This article has been reviewed by <a href=https://github.com/Furisto>Thomas Schubart</a> and some additions have been made. Thank you very much.</p><h2 id=-conclusion>ğŸ’¬ Conclusion</h2><p>We are always eager for new contributers.
We don't have a sponsor feature on GitHub, so please give us a star to encourage us.</p><script async defer src=https://buttons.github.io/buttons.js></script><center><a class=github-button target=_blank rel="noopener noreferrer" href=https://github.com/containers/youki data-color-scheme="no-preference: light; light: light; dark: dark;" data-size=large data-show-count=true aria-label="Star containers/youki on GitHub">Star</a></center></div><div class=article-footer><a class=muted href=https://www.utam0k.jp/en/blog/>â† Back to blog</a><div class=article-nav><a class=nav-arrow href=https://www.utam0k.jp/en/blog/2021/12/24/from_dwango_to_gitpod/>â† from :dwango: to :gitpod:</a>
<a class=nav-arrow href=https://www.utam0k.jp/en/blog/2025/01/10/kubernetes-single-process-oom-kill/>Resolving Out-Of-Memory Issues in Kubernetes with cgroup v2 â†’</a></div></div></article><aside class=toc-desktop><nav class=toc aria-label="Table of contents"><p class=toc__title>Contents</p><div class=toc__body><nav id=TableOfContents><ul><li><ul><li><a href=#-what-is-youki>ğŸ¤” What is youki?</a></li><li><a href=#why-another-container-runtime>Why another container runtime?</a></li><li><a href=#implementation-status>Implementation status</a></li><li><a href=#how-to-get-started>How to get started</a></li><li><a href=#-motivation>ğŸ’ª Motivation</a></li><li><a href=#-join-youki>ğŸ¤ Join youki!</a></li><li><a href=#-a-short-history-of-youki>ğŸ‘£ A short history of youki</a></li><li><a href=#-acknowledgement>ğŸ¥° Acknowledgement</a></li><li><a href=#-conclusion>ğŸ’¬ Conclusion</a></li></ul></li></ul></nav></div></nav><div class=sidebar-profile><a class=sidebar-profile__name href=https://www.utam0k.jp/en/about/>Toru Komatsu</a><div class=sidebar-profile__links><a class=social-btn href=https://github.com/utam0k target=_blank rel="noopener noreferrer" aria-label=GitHub><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .5A12 12 0 008.21 23.9c.6.1.82-.26.82-.58.0-.29-.01-1.05-.02-2.06-3.34.73-4.04-1.61-4.04-1.61-.54-1.37-1.32-1.73-1.32-1.73-1.08-.74.08-.73.08-.73 1.19.08 1.81 1.22 1.81 1.22 1.06 1.8 2.79 1.28 3.47.98.1-.77.42-1.28.76-1.58-2.66-.3-5.47-1.34-5.47-5.95.0-1.32.47-2.4 1.24-3.25-.13-.3-.54-1.52.12-3.16.0.0 1.01-.32 3.3 1.24a11.5 11.5.0 016 0c2.28-1.56 3.29-1.24 3.29-1.24.66 1.64.25 2.86.12 3.16.77.85 1.23 1.93 1.23 3.25.0 4.62-2.81 5.64-5.49 5.94.43.37.81 1.11.81 2.24.0 1.62-.02 2.93-.02 3.33.0.32.21.7.83.58A12 12 0 0012 .5z"/></svg></a>
<a class=social-btn href=https://x.com/utam0k target=_blank rel="noopener noreferrer" aria-label="X (Twitter)"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h5.3l3.4 4.8L14.8 3H21l-6.8 9.2L21 21h-5.3L12 15.8 8.2 21H3l6.8-8.9L3 3z"/></svg></a></div></div><div class="share-block share-block--desktop"><div class=toc-share aria-label="Share this post"><button type=button class="share-btn share-btn--native" data-share-native data-share-url=https://www.utam0k.jp/en/blog/2021/12/27/youki_first_release/ data-share-title="Hello, youki!" aria-label="Native share" hidden>
<svg viewBox="0 -960 960 960" aria-hidden="true"><path d="M680-80q-50 0-85-35t-35-85q0-6 3-28L282-392q-16 15-37 23.5t-45 8.5q-50 0-85-35t-35-85 35-85 85-35q24 0 45 8.5t37 23.5l281-164q-2-7-2.5-13.5T560-760q0-50 35-85t85-35 85 35 35 85-35 85-85 35q-24 0-45-8.5T598-672L317-508q2 7 2.5 13.5t.5 14.5-.5 14.5T317-452l281 164q16-15 37-23.5t45-8.5q50 0 85 35t35 85-35 85-85 35zm0-80q17 0 28.5-11.5T720-2e2t-11.5-28.5T680-240t-28.5 11.5T640-2e2t11.5 28.5T680-160zM2e2-440q17 0 28.5-11.5T240-480t-11.5-28.5T2e2-520t-28.5 11.5T160-480t11.5 28.5T2e2-440zm480-280q17 0 28.5-11.5T720-760t-11.5-28.5T680-8e2t-28.5 11.5T640-760t11.5 28.5T680-720zm0 520zM2e2-480zm480-280z"/></svg>
<span class=sr-only>Share</span>
</button>
<a class=share-btn href="https://twitter.com/intent/tweet?text=Hello%2c%20youki%21&url=https%3a%2f%2fwww.utam0k.jp%2fen%2fblog%2f2021%2f12%2f27%2fyouki_first_release%2f" target=_blank rel="noopener noreferrer"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h5.3l3.4 4.8L14.8 3H21l-6.8 9.2L21 21h-5.3L12 15.8 8.2 21H3l6.8-8.9L3 3z"/></svg>
<span class=sr-only>Share on X</span>
</a><a class=share-btn href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fwww.utam0k.jp%2fen%2fblog%2f2021%2f12%2f27%2fyouki_first_release%2f&title=Hello%2c%20youki%21" target=_blank rel="noopener noreferrer"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20.47.0C22.42.0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42.0 20.47V3.53C0 1.58 1.58.0 3.53.0h16.94zM8.61 17.25c1.2.0 2.06-.04 2.58-.12.53-.08.98-.22 1.32-.41.45-.23.78-.56 1.02-.99.24-.43.36-.91.36-1.48.0-.78-.21-1.4-.63-1.87-.42-.48-.99-.74-1.74-.79.66-.18 1.16-.45 1.46-.81.32-.34.47-.82.47-1.42.0-.48-.1-.88-.3-1.26-.21-.36-.5-.65-.88-.87-.35-.2-.74-.32-1.22-.4-.46-.08-1.29-.12-2.48-.12H5.65v10.46H8.6zm.74-4.19c.7.0 1.18.09 1.44.27.27.18.4.5.4.93.0.4-.14.69-.42.86-.27.18-.76.25-1.44.25H8.31v-2.31h1.03zm8.66.71V6.71h-2.46v7.06h2.46zM8.93 9.08c.71.0 1.19.08 1.43.24.25.16.37.44.37.84.0.38-.13.65-.39.8-.27.16-.75.24-1.45.24h-.57V9.08h.61z"/></svg>
<span class=sr-only>ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</span>
</a><a class=share-btn href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.utam0k.jp%2fen%2fblog%2f2021%2f12%2f27%2fyouki_first_release%2f&title=Hello%2c%20youki%21" target=_blank rel="noopener noreferrer"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20.45 3.5H3.55A1.55 1.55.0 002 5.05v13.9A1.55 1.55.0 003.55 20.5h16.9A1.55 1.55.0 0022 18.95V5.05A1.55 1.55.0 0020.45 3.5zM7.14 18.1H4.54V9.88h2.6V18.1zm-1.3-9.36a1.51 1.51.0 110-3.02 1.51 1.51.0 010 3.02zM19 18.1h-2.6v-4.96c0-1.18-.42-1.99-1.48-1.99-.81.0-1.3.55-1.51 1.09-.08.19-.1.46-.1.73v5.13H10.7s.03-8.32.0-9.18h2.6v1.3c.35-.54.98-1.31 2.39-1.31 1.74.0 3.31 1.13 3.31 3.56V18.1z"/></svg>
<span class=sr-only>Share on LinkedIn</span></a></div></div></aside></div><button type=button class=mobile-toc-fab data-toc-modal=#mobile-toc-modal aria-pressed=false>
<span class=mobile-toc-fab__label>TOC</span>
<svg class="mobile-toc-fab__icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 14l6-6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button></main><footer class=site-footer><div class=footer-meta><span>&copy; 2025 Toru Komatsu</span>
<a href=https://x.com/utam0k target=_blank rel=noopener class=muted>@utam0k</a></div><div class=footer-links><a class=muted href=https://www.utam0k.jp/en/index.xml>RSS</a>
<a class=muted href=https://github.com/utam0k target=_blank rel=noopener>GitHub</a></div></footer></div><script defer src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script defer type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><script>(()=>{const e=()=>{const e=window.matchMedia("(max-width: 1024px)").matches,t=/Mobi|Android/i.test(navigator.userAgent),n=e||t;document.body.dataset.isMobile=n?"true":"false"};e(),window.addEventListener("resize",e,{passive:!0})})(),(()=>{const t=()=>Array.from(document.querySelectorAll("[data-toc-modal]")),n=()=>Array.from(document.querySelectorAll(".toc-modal")),u=()=>Array.from(document.querySelectorAll(".toc-modal__overlay")),r=e=>t().filter(t=>t.dataset.tocModal===`#${e?.id}`),s=(e,t)=>{r(e).forEach(e=>{e.classList.toggle("is-active",t),e.setAttribute("aria-pressed",t?"true":"false")})},c=e=>{if(!e)return;e.classList.add("is-open"),e.hidden=!1,document.body.classList.add("toc-open"),s(e,!0)},e=e=>{if(!e)return;e.style.transform="",e.classList.remove("is-open"),e.hidden=!0,document.body.classList.remove("toc-open"),s(e,!1)},o=()=>n().forEach(t=>e(t)),l=t=>{if(!t)return;t.classList.contains("is-open")?e(t):c(t)},i=()=>{t().forEach(e=>e.classList.add("is-visible"))},d=t=>{let n=0,s=0,o=!1;const i=80,a=e=>{const i=t.querySelector(".toc-modal__handle"),a=t.querySelector(".toc-modal__header"),r=i?.contains(e.target)||a?.contains(e.target),c=t.scrollTop<=0;if(!r&&!c)return;o=!0,n=e.touches[0].clientY,s=n,t.style.transition="none"},r=e=>{if(!o)return;s=e.touches[0].clientY;const i=s-n;i>0&&(t.style.transform=`translateY(${i}px)`,e.preventDefault())},c=()=>{if(!o)return;o=!1,t.style.transition="";const a=s-n;a>i?e(t):t.style.transform=""};t.addEventListener("touchstart",a,{passive:!0}),t.addEventListener("touchmove",r,{passive:!1}),t.addEventListener("touchend",c,{passive:!0})},a=()=>{t().forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tocModal,n=t?document.querySelector(t):null;l(n)})}),n().forEach(e=>d(e)),document.addEventListener("click",t=>{if(t.target?.classList?.contains("toc-modal__overlay")&&o(),t.target?.matches("[data-toc-close]")){const n=t.target.closest(".toc-modal");e(n)}t.target?.closest(".toc-modal")&&t.target.tagName==="A"&&o()}),window.addEventListener("scroll",i,{passive:!0}),i()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a()})(),(()=>{const e=document.querySelector(".site-header");if(!e)return;const s=()=>document.body.dataset.isMobile==="true";if(s())return;let t=window.scrollY,n=!1;const o=8,i=()=>{const n=window.scrollY;if(n<80){e.classList.remove("is-hidden"),t=n;return}if(Math.abs(n-t)<o)return;n>t?e.classList.add("is-hidden"):e.classList.remove("is-hidden"),t=n};window.addEventListener("scroll",()=>{if(n)return;n=!0,requestAnimationFrame(()=>{i(),n=!1})},{passive:!0})})(),(()=>{const e=document.querySelector(".share-block--mobile");if(!e)return;const o=()=>document.body.dataset.isMobile==="true";let t=window.scrollY,s=!1;const i=4,a=80,r=()=>{if(e.classList.contains("is-floating"))return;e.classList.add("is-floating"),document.body.classList.add("has-mobile-share")},c=()=>{e.classList.remove("is-floating","is-visible"),document.body.classList.remove("has-mobile-share")},n=()=>{if(!o()){c();return}r();const n=window.scrollY;if(n<a){e.classList.add("is-visible"),t=n;return}if(Math.abs(n-t)<i)return;const s=n<t;s?e.classList.add("is-visible"):e.classList.remove("is-visible"),t=n};window.addEventListener("scroll",()=>{if(s)return;s=!0,requestAnimationFrame(()=>{n(),s=!1})},{passive:!0}),window.addEventListener("resize",n,{passive:!0}),window.addEventListener("orientationchange",n,{passive:!0}),n()})(),(()=>{const e=document.querySelector("[data-share-native]");if(!e)return;const n=e.dataset.shareUrl||location.href,s=e.dataset.shareTitle||document.title,o=()=>document.body.dataset.isMobile==="true",i=()=>{e.hidden=!1,e.addEventListener("click",async e=>{e.preventDefault();try{await navigator.share({title:s,url:n})}catch(e){if(e&&e.name==="AbortError")return;console.warn("Native share failed",e)}})},t=()=>{navigator.share&&o()?i():e.remove()};t(),window.addEventListener("resize",t,{passive:!0}),window.addEventListener("orientationchange",t,{passive:!0})})(),(()=>{const e=document.querySelector("[data-menu-toggle]"),s=document.getElementById("mobile-menu"),t=document.querySelector("[data-menu-overlay]");if(!e||!s)return;const i=()=>document.body.dataset.isMobile==="true",o=n=>{e.classList.toggle("is-open",n),e.setAttribute("aria-expanded",n?"true":"false"),s.hidden=!n,s.classList.toggle("is-open",n),t&&(t.hidden=!n,t.classList.toggle("is-open",n)),document.body.classList.toggle("menu-open",n)},a=()=>o(e.getAttribute("aria-expanded")!=="true"),n=()=>o(!1);e.addEventListener("click",e=>{e.stopPropagation(),a()}),document.querySelectorAll("[data-menu-close]").forEach(e=>e.addEventListener("click",n)),document.addEventListener("click",t=>{!s.contains(t.target)&&!e.contains(t.target)&&n()}),t&&t.addEventListener("click",n),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()}),window.addEventListener("resize",()=>{i()||n()},{passive:!0})})()</script><script>(()=>{const s=Array.from(document.querySelectorAll(".toc__body a"));if(!s.length)return;const r=e=>decodeURIComponent(e.hash.replace("#","")),o=new Map;s.forEach(e=>{const t=r(e),n=o.get(t)||[];n.push(e),o.set(t,n)});const t=Array.from(new Set(s.map(e=>document.getElementById(r(e))).filter(Boolean)));if(!t.length)return;const i=e=>{o.forEach((t,n)=>{t.forEach(t=>t.classList.toggle("is-active",n===e))})},e=()=>{const n=window.scrollY+120;let e=t[0].id;for(const s of t)if(s.offsetTop<=n)e=s.id;else break;return i(e),e};let n=t[0].id;if(i(n),"IntersectionObserver"in window){const s=new Map,o=()=>{if(s.size){const e=Array.from(s.values()).sort((e,t)=>e.boundingClientRect.top-t.boundingClientRect.top)[0];n=e.target.id,i(n)}else n=e()},a=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.id;e.isIntersecting?s.set(t,e):s.delete(t)}),o()},{rootMargin:"0px 0px -65% 0px",threshold:[0,.1,.5]});t.forEach(e=>a.observe(e)),window.addEventListener("load",o),window.addEventListener("resize",o,{passive:!0});return}let a=!1;const c=()=>{if(a)return;a=!0,requestAnimationFrame(()=>{e(),a=!1})};window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",e,{passive:!0}),window.addEventListener("load",e),document.querySelectorAll("img").forEach(t=>t.addEventListener("load",e,{once:!0})),e()})()</script><script>(()=>{const t=Array.from(document.querySelectorAll(".article-body img"));if(!t.length)return;const e=document.createElement("div");e.className="lightbox-backdrop",e.innerHTML='<img alt="">',document.body.appendChild(e);const n=e.querySelector("img"),s=()=>e.classList.remove("is-open");e.addEventListener("click",s),document.addEventListener("keydown",e=>{e.key==="Escape"&&s()}),t.forEach(t=>{t.addEventListener("click",()=>{n.src=t.src,n.alt=t.alt||"",e.classList.add("is-open")})})})()</script><script>(()=>{if(typeof gtag!="function")return;document.addEventListener("click",e=>{const t=e.target.closest("a[href]");if(!t)return;const n=new URL(t.href,location.origin);n.hostname!==location.hostname&&gtag("event","click",{event_category:"outbound",event_label:t.href,transport_type:"beacon"})});const d=[25,50,75,100],a=new Set,c=()=>{const t=window.scrollY,e=document.documentElement.scrollHeight-window.innerHeight;if(e<=0)return;const n=Math.round(t/e*100);d.forEach(e=>{n>=e&&!a.has(e)&&(a.add(e),gtag("event","scroll_depth",{event_category:"engagement",event_label:e+"%",value:e}))})};let n=!1;window.addEventListener("scroll",()=>{if(n)return;n=!0,requestAnimationFrame(()=>{c(),n=!1})},{passive:!0}),document.body.classList.contains("error404")&&gtag("event","page_not_found",{event_category:"error",event_label:location.pathname+location.search,page_referrer:document.referrer});const l=Date.now(),i=()=>{const e=Math.round((Date.now()-l)/1e3);e>5&&gtag("event","read_time",{event_category:"engagement",event_label:location.pathname,value:e})};window.addEventListener("beforeunload",i),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&i()}),document.addEventListener("click",e=>{const t=e.target.closest("a[href]");if(!t)return;const n=t.href,s=[{pattern:/github\.com\/utam0k/i,platform:"github"},{pattern:/x\.com\/utam0k|twitter\.com\/utam0k/i,platform:"x"},{pattern:/linkedin\.com\/in\/utam0k/i,platform:"linkedin"}];for(const{pattern:e,platform:t}of s)if(e.test(n)){gtag("event","author_social_click",{event_category:"engagement",event_label:t,link_url:n});break}}),document.addEventListener("click",e=>{const t=e.target.closest(".share-btn, [data-share], [data-share-native]");if(!t)return;const n=t.dataset.share||t.dataset.platform||t.getAttribute("aria-label")||"unknown";gtag("event","share",{event_category:"engagement",event_label:n.toLowerCase(),content_type:"article",item_id:location.pathname})});const t=document.referrer,s=new URLSearchParams(location.search),o=s.get("utm_source")||"",u=s.get("utm_medium")||"",h=s.get("utm_campaign")||"";let e="direct";if(o)e=o;else if(t)try{const n=new URL(t).hostname;/google\./i.test(n)?e="google":/bing\./i.test(n)?e="bing":/twitter\.com|x\.com/i.test(n)?e="x":/facebook\.com/i.test(n)?e="facebook":/linkedin\.com/i.test(n)?e="linkedin":/t\.co/i.test(n)?e="x":e=n}catch{e="referral"}gtag("event","traffic_source",{event_category:"acquisition",event_label:e,referrer:t||"direct",utm_source:o,utm_medium:u,utm_campaign:h}),document.addEventListener("copy",()=>{const e=window.getSelection()?.toString()||"";e.length>10&&gtag("event","text_copy",{event_category:"engagement",event_label:location.pathname,text_length:e.length})}),document.addEventListener("click",e=>{const t=e.target.closest("a[href]");if(!t)return;try{const e=new URL(t.href,location.origin);e.hostname===location.hostname&&e.pathname!==location.pathname&&gtag("event","internal_link",{event_category:"navigation",event_label:e.pathname,link_text:t.textContent?.trim().slice(0,50)||"",from_page:location.pathname})}catch{}});const r=window.__setTheme;r&&(window.__setTheme=e=>{r(e),gtag("event","theme_change",{event_category:"preference",event_label:e||document.documentElement.dataset.theme})}),document.addEventListener("click",e=>{const t=e.target.closest('.lang-choice, [data-lang], .meta-link[href*="/en/"], .meta-link[href*="/ja/"]');if(!t)return;const n=t.href||"",s=n.includes("/en/")?"en":"ja";gtag("event","language_switch",{event_category:"preference",event_label:s,from_lang:document.documentElement.lang||"unknown"})}),document.addEventListener("click",e=>{const t=e.target.closest(".toc a, .toc__body a");if(!t)return;gtag("event","toc_click",{event_category:"navigation",event_label:t.textContent?.trim().slice(0,50)||"",target_id:t.hash||""})}),document.addEventListener("click",e=>{const t=e.target.closest('a[href*="index.xml"], a[href*=".rss"], a[href*="/feed"]');if(!t)return;gtag("event","rss_click",{event_category:"engagement",event_label:location.pathname})}),window.addEventListener("beforeprint",()=>{gtag("event","page_print",{event_category:"engagement",event_label:location.pathname})})})()</script></body></html>