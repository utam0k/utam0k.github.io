<!doctype html><html><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-119773781-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Rustのstd::default::Default &ndash; うたもく</title><meta name=description property="og:description" content="|utam0k"><meta name=apple-mobile-web-app-title content="うたもく"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@utam0k"><meta name=twitter:creator content="@utam0k"><meta name=twitter:title content="Rustのstd::default::Default"><meta name=twitter:image content="https://www.utam0k.jp/img/logo.png"><meta property="og:title" content="Rustのstd::default::Default"><meta property="og:url" content="https://www.utam0k.jp/blog/2018/05/28/rust_std_default/"><meta property="og:type" content="website"><meta property="og:site_name" content="うたもく"><meta name=og:image content="https://www.utam0k.jp/img/logo.png"><link rel=stylesheet href=https://www.utam0k.jp/assets/syntax.css><link rel=stylesheet href=https://www.utam0k.jp/assets/style.css><link rel=stylesheet href=https://www.utam0k.jp/assets/custom_style.css><link href=https://unpkg.com/@primer/css@^16.0.0/dist/primer.css rel=stylesheet></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav-right px-3"><a class="d-inline-flex UnderlineNav-actions muted-link h2" href=https://www.utam0k.jp/><img class="avatar avatar-5 mr-2" src=https://www.utam0k.jp/img/logo.png><div class=hide-sm><span>うたもく</span></div></a><div class=UnderlineNav-body><a class=UnderlineNav-item href=https://www.utam0k.jp/post/><span>Posts</span></a>
<a class=UnderlineNav-item href=https://www.utam0k.jp/page/about/><span>About</span></a>
<a class=UnderlineNav-item href=https://www.utam0k.jp/tags><span>Tags</span></a>
<a class=UnderlineNav-item href=https://www.utam0k.jp/en/><span>EN</span></a>
<a class=UnderlineNav-item href=https://www.utam0k.jp/index.xml><span>Atom</span></a></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">Rustのstd::default::Default</div></div><div class=Subhead-description><a href=https://www.utam0k.jp/tags/tech class=muted-link><span class="Label Label--gray">tech</span></a>
<a href=https://www.utam0k.jp/tags/rust class=muted-link><span class="Label Label--gray">rust</span></a><div class=float-md-right><span title="Lastmod: 2018-05-28. Published at: 2018-05-28.">Published: 2018-05-28</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><p>Rustのstdに<a href=https://doc.rust-lang.org/std/default/trait.Default.html>Default</a>というのがある。<br>構造体のデフォルト値を決めることができる。<br>実用例からlibcoreでのどのような実装になっているかを見てみた。</p><p>traitはこんな感じ。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=nb>Default</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>default</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><h2 id=example>Example</h2><ol><li><p>Defaultなし<br>Defaultを利用しないとこんな感じで<code>new()</code>を作るようになる。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>new</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>foo</span>: <span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>bar</span>: <span class=mf>0.0</span><span class=k>f32</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>options</span>: <span class=nc>SomeOptions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SomeOptions</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div></li><li><p>Defaultを使う<br>以下は<a href=https://doc.rust-lang.org/std/default/trait.Default.html>ドキュメント</a>のコードです。<br><code>#[derive]</code><a href=http://rust-lang-ja.org/rust-by-example/attribute.html>アトリビュート</a>で<a href=https://doc.rust-lang.org/std/default/trait.Default.html>Default</a>を使うことで<code>Default::default()</code>が<code>SomeOptions::new()</code>の代わりになって<code>new()</code>を定義する必要がなくなりました！はい、便利。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Default)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>options</span>: <span class=nc>SomeOptions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Default</span>::<span class=n>default</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div></li><li><p>一部の値だけデフォルトを用いる<br>以下は<a href=https://doc.rust-lang.org/std/default/trait.Default.html>ドキュメント</a>のコードです。<br>一部の値だけデフォルトの値を使うともできる</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>foo</span>: <span class=mi>42</span><span class=p>,</span><span class=w> </span><span class=p>..</span><span class=nb>Default</span>::<span class=n>default</span><span class=p>()</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div></li><li><p>Defaultを実装する<br>Defaultトレイトを自分で実装することももちろん可能。<br>ドキュメントではEnumを用いた<a href=https://doc.rust-lang.org/std/default/trait.Default.html#how-can-i-implement-default>コード</a>を紹介していた。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=nb>Default</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>default</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>foo</span>: <span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>bar</span>: <span class=mf>0.0</span><span class=k>f32</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>options</span>: <span class=nc>SomeOptions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Default</span>::<span class=n>default</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div></li><li><p>unwrap_or_default()<br><code>Result</code>や<code>Option</code>では<a href=https://doc.rust-lang.org/std/option/enum.Option.html#method.unwrap_or_default>unwrap_or_default()</a>という関数が実装されている。<br>Optionを用いた例</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Default, Debug, PartialEq)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>options</span>: <span class=nc>SomeOptions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>None</span><span class=p>.</span><span class=n>unwrap_or_default</span><span class=p>();</span><span class=w>
</span><span class=w>    </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>options</span><span class=p>,</span><span class=w> </span><span class=nb>Default</span>::<span class=n>default</span><span class=p>());</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div></li><li><p>実用例<br><a href=https://github.com/glium/glium>glium</a>というOpenGLのラッパーでは<a href=https://github.com/glium/glium/blob/v0.13.5/src/draw_parameters/mod.rs#L246-L381>DrawParameters</a>というでかい構造体がある。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>DrawParameters</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>depth</span>: <span class=nc>Depth</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>stencil</span>: <span class=nc>Stencil</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>blend</span>: <span class=nc>Blend</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>color_mask</span>: <span class=p>(</span><span class=kt>bool</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>line_width</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>point_size</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>clip_planes_bitmask</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>backface_culling</span>: <span class=nc>BackfaceCullingMode</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>polygon_mode</span>: <span class=nc>PolygonMode</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>multisampling</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>dithering</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>viewport</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Rect</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>scissor</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Rect</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>draw_primitives</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>samples_passed_query</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>SamplesQueryParam</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>time_elapsed_query</span>: <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=n>TimeElapsedQuery</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>primitives_generated_query</span>: <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=n>PrimitivesGeneratedQuery</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>transform_feedback_primitives_written_query</span>:
        <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=n>TransformFeedbackPrimitivesWrittenQuery</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>condition</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>ConditionalRendering</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>transform_feedback</span>: <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=n>TransformFeedbackSession</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>smooth</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Smooth</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>provoking_vertex</span>: <span class=nc>ProvokingVertex</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>primitive_bounding_box</span>: <span class=p>(</span><span class=n>Range</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>Range</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>Range</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>Range</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>primitive_restart_index</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>さすがにこれを毎回書くのはしんどいのでDefaultトレイトが<a href=https://github.com/glium/glium/blob/v0.13.5/src/draw_parameters/mod.rs#L421-L448>実装</a>されている。
Defaultトレイトを実装することでDefaultから変更したい箇所だけ書けばよくなる。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=kd>let</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>glium</span>::<span class=n>DrawParameters</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>point_size</span>: <span class=nb>Some</span><span class=p>(</span><span class=mf>5.0</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>multisampling</span>: <span class=nc>false</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>..</span><span class=nb>Default</span>::<span class=n>default</span><span class=p>()</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span></code></pre></div></li></ol><h2 id=詳細>詳細</h2><p>Rustのcoreライブラリではデフォルト値が決まっているものがある。
1.26時点では以下のようになっている。</p><table><thead><tr><th>type</th><th>default</th></tr></thead><tbody><tr><td>bool</td><td>false</td></tr><tr><td>char</td><td>&lsquo;\x00&rsquo;</td></tr><tr><td>usize</td><td>0</td></tr><tr><td>u8</td><td>0</td></tr><tr><td>u16</td><td>0</td></tr><tr><td>u32</td><td>0</td></tr><tr><td>u64</td><td>0</td></tr><tr><td>u128</td><td>0</td></tr><tr><td>isize</td><td>0</td></tr><tr><td>i8</td><td>0</td></tr><tr><td>i16</td><td>0</td></tr><tr><td>i32</td><td>0</td></tr><tr><td>i64</td><td>0</td></tr><tr><td>i128</td><td>0</td></tr><tr><td>f32</td><td>0</td></tr><tr><td>f64</td><td>0</td></tr></tbody></table><h3 id=libcoreの実装>libcoreの実装</h3><p>1.26のDefaultのは<code>default_imp!</code>というマクロを用いて実装されている。<br>実際の<a href=https://github.com/rust-lang/rust/blob/1.26.0/src/libcore/default.rs#L128-L158>実装コード</a>を見てもらうとがさっきの表の箇所が実装されているのがわかる。</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=n>macro_rules</span><span class=o>!</span><span class=w> </span><span class=n>default_impl</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=p>(</span><span class=cp>$t</span>:<span class=nc>ty</span><span class=p>,</span><span class=w> </span><span class=cp>$v</span>:<span class=nc>expr</span><span class=p>,</span><span class=w> </span><span class=cp>$doc</span>:<span class=nc>tt</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=cp>#[stable(feature = </span><span class=s>&#34;rust1&#34;</span><span class=cp>, since = </span><span class=s>&#34;1.0.0&#34;</span><span class=cp>)]</span><span class=w>
</span><span class=w>        </span><span class=k>impl</span><span class=w> </span><span class=nb>Default</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=cp>$t</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=cp>#[inline]</span><span class=w>
</span><span class=w>            </span><span class=cp>#[doc = $doc]</span><span class=w>
</span><span class=w>            </span><span class=k>fn</span> <span class=nf>default</span><span class=p>()</span><span class=w> </span>-&gt; <span class=cp>$t</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cp>$v</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>default_impl</span><span class=o>!</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=kt>bool</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Returns the default value of `false`&#34;</span><span class=w> </span><span class=p>}</span><span class=w>
</span></code></pre></div><p>これ以外にも<code>tuple</code>でも<a href=https://github.com/rust-lang/rust/blob/1.26.0/src/libcore/tuple.rs#L73-L78>実装</a>されていた。<br>他にも<a href=https://doc.rust-lang.org/std/default/trait.Default.html#implementors>いっぱい</a>あるみたいです。</p><h2 id=追記2018-05-29>追記(2018-05-29)</h2><p><a href=https://mastodon.cardina1.red/@lo48576>lo48576さん</a>さんにこんなこともできるよと教えていただいたので追記。</p><h3 id=その1>その1</h3><p><code>std::default::Default</code>は<a href=https://github.com/rust-lang/rust/blob/1.26.0/src/libcore/prelude/v1.rs#L44>prelude経由</a>で自動的にインポートされています。
<code>Default::default()</code>の代わりに<code>SomeOptions::default()</code>でできます。</p><p><em>Example1の改良</em></p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Default)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SomeOptions</span>::<span class=n>default</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><h3 id=その2>その2</h3><p><code>#[derive(Default)]</code>を用いた以下のようなコードはコンパイルが通りません。</p><p><code>Option</code>のデフォルトは<code>None</code>なので<code>NoDefault構造体</code>は<code>Default</code>を実装する必要がありません。<br>コンパイルを通するには<code>Default</code>を実装します。</p><p><em>NG:</em></p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=c1>// Struct with no default impl.
</span><span class=c1></span><span class=k>struct</span> <span class=nc>NoDefault</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cp>#[derive(Default)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=c1>// ERROR!
</span><span class=c1></span><span class=w>    </span><span class=c1>// error[E0599]: no function or associated 
</span><span class=c1></span><span class=w>    </span><span class=c1>// item named `default` found for type 
</span><span class=c1></span><span class=w>    </span><span class=c1>// `SomeOptions&lt;NoDefault&gt;` in the 
</span><span class=c1></span><span class=w>    </span><span class=c1>// current scope
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SomeOptions</span>::<span class=o>&lt;</span><span class=n>NoDefault</span><span class=o>&gt;</span>::<span class=n>default</span><span class=p>();</span><span class=w> </span><span class=c1>// NG
</span><span class=c1></span><span class=p>}</span><span class=w>
</span></code></pre></div><p><em>OK:</em></p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=c1>// Struct with no default impl.
</span><span class=c1></span><span class=k>struct</span> <span class=nc>NoDefault</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>SomeOptions</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>foo</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>bar</span>: <span class=kt>f32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=w> </span><span class=nb>Default</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>SomeOptions</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>default</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=n>foo</span>: <span class=nb>Default</span>::<span class=n>default</span><span class=p>(),</span><span class=w>
</span><span class=w>            </span><span class=n>bar</span>: <span class=nb>Default</span>::<span class=n>default</span><span class=p>(),</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SomeOptions</span>::<span class=o>&lt;</span><span class=n>NoDefault</span><span class=o>&gt;</span>::<span class=n>default</span><span class=p>();</span><span class=w> </span><span class=c1>// OK
</span><span class=c1></span><span class=p>}</span><span class=w>
</span></code></pre></div><p><a href=http://qnighy.hatenablog.com/entry/2017/06/01/070000>qnighyさんの記事</a>や<a href=https://blog.cardina1.red/2016/03/24/rust-default-wont-compile/>lo48576さんの記事</a>
の記事が参考になると思います。</p></section><section><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"utam0k"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>Rustのstd::default::Default</b><nav id=TableOfContents><ul><li><a href=#example>Example</a></li><li><a href=#詳細>詳細</a><ul><li><a href=#libcoreの実装>libcoreの実装</a></li></ul></li><li><a href=#追記2018-05-29>追記(2018-05-29)</a><ul><li><a href=#その1>その1</a></li><li><a href=#その2>その2</a></li></ul></li></ul></nav></div><div><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-show-count=false>Tweet</a><script async src=https://platform.twitter.com/widgets.js></script>
<iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button&size=small&mobile_iframe=true&width=61&height=20&appId" width=61 height=20 style=border:none;overflow:hidden scrolling=no frameborder=0 allowtransparency=true allow=encrypted-media></iframe>
<a href=http://b.hatena.ne.jp/entry/ class=hatena-bookmark-button data-hatena-bookmark-layout=basic-label-counter data-hatena-bookmark-lang=ja title=このエントリーをはてなブックマークに追加><img src=https://b.st-hatena.com/images/entry-button/button-only@2x.png alt=このエントリーをはてなブックマークに追加 width=20 height=20 style=border:none></a><script type=text/javascript src=https://b.st-hatena.com/js/bookmark_button.js async></script></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"></div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script></body></html>