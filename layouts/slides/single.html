{{ define "title" }}{{ .Title }} | Slides | {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="slides-shell">
  <div class="slides-embed">
    {{ partial "speakerdeck-embed.html" . }}
  </div>

  {{ $toc := .TableOfContents }}
  {{ $tocId := "mobile-toc-inline" }}
  {{ $tocModalId := "mobile-toc-modal" }}
  {{ $hasToc := gt (len ($toc | plainify)) 0 }}
  {{ $authorName := .Params.author | default (.Site.Params.author.name | default "") }}
  {{ $authorHandle := cond (and (not (isset .Params "author")) (.Site.Params.author.twitter)) (printf "@%s" .Site.Params.author.twitter) ($authorName | default (.Site.Params.author.name | default "unknown")) }}
  {{ $authorLink := "/page/about/" | relLangURL }}
  {{ with .Site.Menus.main }}
    {{ $about := where . "Name" "About" }}
    {{ if gt (len $about) 0 }}
      {{ $authorLink = (index $about 0).URL | relLangURL }}
    {{ end }}
  {{ end }}
  {{ $langs := slice (dict "label" (.Lang | upper) "url" .RelPermalink) }}
  {{ with .Translations }}
    {{ range . }}
      {{ $langs = $langs | append (dict "label" (.Lang | upper) "url" .RelPermalink) }}
    {{ end }}
  {{ end }}

  {{ $coPresented := .Params.co_presenters }}
  <article class="article slides-article">
    <header class="article-hero article-hero--stack">
      <h1 class="article-title">{{ .Title }}</h1>
      {{ partial "share-buttons.html" . }}
      <div class="article-meta article-meta--stack">
        <div class="meta-row">date: <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006-01-02" }}</time></div>
        <div class="meta-row">author: {{ if $authorLink }}<a class="meta-link" href="{{ $authorLink | relLangURL }}">{{ $authorHandle }}</a>{{ else }}{{ $authorHandle }}{{ end }}{{ if $coPresented }} and others{{ end }}</div>
        {{ with .Params.event }}<div class="meta-row">event: {{ . }}</div>{{ end }}
        {{ if $coPresented }}<div class="meta-row">co-presented</div>{{ end }}
        {{ with .Params.tags }}<div class="meta-row">tags: [{{ range $i, $tag := . }}{{ if $i }}, {{ end }}<a class="meta-link" href="{{ "/tags/" | relLangURL }}{{ urlize $tag }}">{{ $tag }}</a>{{ end }}]</div>{{ end }}
        {{ if gt (len $langs) 1 }}
        <div class="meta-row">languages: [
          {{ range $i, $l := $langs }}
            {{ if $i }}, {{ end }}
            {{ if eq $.Lang (lower $l.label) | or (eq $l.label (upper $.Lang)) }}
              <span class="meta-lang-current">{{ $l.label }}</span>
            {{ else }}
              <a class="meta-link" href="{{ $l.url }}">{{ $l.label }}</a>
            {{ end }}
          {{ end }}
        ]</div>
        {{ end }}
        {{ with .Params.speakerdeck_url }}<div class="meta-row">slides: <a class="meta-link" href="{{ . }}" target="_blank" rel="noopener">Speaker Deck</a></div>{{ end }}
      </div>
    </header>

    <div class="meta-separator" aria-hidden="true">---</div>

    {{ if $hasToc }}
    <details class="toc-inline" id="{{ $tocId }}">
      <summary>{{ i18n "toc_summary" | default "Table of contents" }}</summary>
      {{ partial "toc.html" . }}
    </details>
    <div class="toc-modal" id="{{ $tocModalId }}" hidden>
      <div class="toc-modal__header">
        <span>{{ i18n "toc_title" | default "Contents" }}</span>
        <button type="button" class="toc-modal__close" data-toc-close>&times;</button>
      </div>
      <div class="toc-modal__body">
        {{ partial "toc.html" . }}
      </div>
    </div>
    <div class="toc-modal__overlay" hidden></div>
    {{ end }}

    <div class="article-body">
      {{ .Content }}
    </div>
    <div class="article-footer">
      <a class="muted" href="{{ "/slides/" | relLangURL }}">← Back to slides</a>
      {{ if or .PrevInSection .NextInSection }}
      <div class="article-nav">
        {{ with .PrevInSection }}<a class="nav-arrow" href="{{ .RelPermalink }}">← {{ .Title }}</a>{{ end }}
        {{ with .NextInSection }}<a class="nav-arrow" href="{{ .RelPermalink }}">{{ .Title }} →</a>{{ end }}
      </div>
      {{ end }}
    </div>
  </article>
</div>

{{ if $hasToc }}
  {{ $tocLabel := cond (eq .Site.Language.Lang "ja") "目次" "TOC" }}
  <button type="button" class="mobile-toc-fab" data-toc-modal="#{{ $tocModalId }}" aria-pressed="false">
    <span class="mobile-toc-fab__label">{{ $tocLabel }}</span>
    <svg class="mobile-toc-fab__icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 14l6-6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
{{ end }}
{{ end }}
