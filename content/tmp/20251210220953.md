---
title: "kubernetes/kubernetes の e2e-node テストをローカルで動かす"
date: 2025-12-10T22:09:53+09:00
draft: false
tags: [kubernetes]
---

```sh {title="e2e-node テストの実行"}
$ KUBE_ROOT=$(pwd) make test-e2e-node TEST_ARGS='--kubelet-flags="--fail-swap-on=false"' FOCUS=Kubelet SKIP=container
```

以下で Kubernetes のソースコードの root dir を探している。が、ローカルがこうなっていることは多くないので、`KUBE_ROOT` で指定するようにすると動いた。

{{< github-code "https://github.com/kubernetes/kubernetes/blob/221bf19ee03801523f2ed7e63a679e2ff8c916e1/test/utils/paths.go#L52-L64" >}}

そもそもの動かし方のメインドキュメントは[ここ](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/e2e-node-tests.md)。
CNI のインストールと設定は以下のようにしました。
```shell {title="CNI のインストール"}
$ CNI_VERSION=v1.5.1
$ wget https://github.com/containernetworking/plugins/releases/download/${CNI_VERSION}/cni-plugins-linux-amd64-${CNI_VERSION}.tgz
$ sudo tar -xvf cni-plugins-linux-amd64-${CNI_VERSION}.tgz -C /opt/cni/bin/
```

ログは `/tmp/_artifacts/$(date)/` にいろいろ入っている。例えば `tail -f /tmp/_artifacts/240921T205914/kubelet.log`